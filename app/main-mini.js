const toHours=e=>{parseInt(e)<0&&(e=-1*parseInt(e));let t=((e=parseInt(e))-e%3600)/3600,o=e-3600*t,n=(o-o%60)/60;return o-=60*n,t<10&&(t="0"+t),n<10&&(n="0"+n),o<10&&(o="0"+o),`${t}:${n}:${o}`},toSeconds=e=>{if(!/(\d{2}:\d{2}):*\d*\d*/g.test(e))throw new Error("Invalid Time Format. Please use {HH:MM} or {HH:MM:SS} format.");const t=parseInt(e.slice(0,2)),o=parseInt(e.slice(3,5));let n=parseInt(e.slice(6,8));return isNaN(n)&&(n=0),3600*t+60*o+n},to12Hour=e=>{if(!/([0-9]{2}:[0-9]{2})/g.test(e))throw new Error("Invalid Time Format. Please use {HH:MM} format.");let t=parseInt(e.slice(0,2));if(t>23||t<0)throw new Error("Time out of range.");return t>12?(t-=12,t<10&&(t="0"+t),`${t}${e.slice(2,5)} PM`):12===t?`${t}${e.slice(2,5)} PM`:0===t?(t=12,`${t}${e.slice(2,5)} AM`):`${e} AM`},to24Hour=e=>(parseInt(e.slice(0,1))<10&&":"===e.slice(1,2)&&(e="0"+e),"AM"===e.slice(9,11)&&"12"===e.slice(0,2)?`00${e.slice(2,8)}`:"AM"===e.slice(9,11)||"PM"===e.slice(9,11)&&"12"===e.slice(0,2)?e.slice(0,8):"PM"===e.slice(9,11)?`${parseInt(e.slice(0,2))+12}${e.slice(2,8)}`:void 0),success=e=>{const t=e.coords;localStorage.setItem("Latitude",t.latitude),localStorage.setItem("Longitude",t.longitude)},error=e=>{console.warn(`ERROR(${e.code}): ${e.message}`)},timing=["Fajr","Sunrise","Dhuhr","Asr","Maghrib","Isha"];let tune,Fajr=0,Sunrise=0,Dhuhr=0,Asr=0,Maghrib=0,Isha=0,Imsak=0,Sunset=0,Midnight=0;const timingOffset=[Fajr,Sunrise,Dhuhr,Asr,Maghrib,Isha],getTune=e=>{let t=document.getElementById(e).value;if(0!==t.length&&!isNaN(parseInt(t)))return parseInt(t)},setTune=()=>{for(let e=0;e<6;e++)localStorage.getItem(`tune${timing[e]}`)&&(timingOffset[e]=localStorage.getItem(`tune${timing[e]}`));tune=`${Imsak},${timingOffset[0]},${timingOffset[1]},${timingOffset[2]},${timingOffset[3]},${timingOffset[4]},${Sunset},${timingOffset[5]},${Midnight}`},reload=()=>{today=initApp(),x=0},toggleSettings=()=>{document.querySelector(".setting").classList.toggle("settings-open"),document.querySelector("#widget").classList.toggle("darken-bg")},errorMessage=(e,t)=>{document.querySelector("#audioCredit").style.display="none",document.querySelector("#errorMessage").style.color=`var(--error-${e})`,document.querySelector("#errorMessage").innerText=t},changeTuneText=()=>{let e=document.querySelector(".tune");"Set Timing Offsets"===e.innerText?e.innerHTML='<img src="images/tune-icon.svg" alt="tune icon" width="16" height="16">Close Timing Offsets':e.innerHTML='<img src="images/tune-icon.svg" alt="tune icon" width="16" height="16">Set Timing Offsets'},reverseLocation=()=>{const e=`https://nominatim.openstreetmap.org/reverse?lat=${localStorage.getItem("Latitude")}&lon=${localStorage.getItem("Longitude")}&format=json`;fetch(e).then((e=>e.json())).then((e=>{e.error?document.getElementById("currentLocation").innerHTML="Device Location":(localStorage.setItem("Location",e.display_name),document.getElementById("currentLocation").innerHTML=e.display_name)})).catch((e=>{console.error("Error fetching suggestions:",e),document.getElementById("currentLocation").innerHTML="Cannot detect location!",document.getElementById("currentLocation").style.color="var(--error-red)"})),document.getElementById("currentLocation").innerHTML="Device Location"};setTune();const getTime=async e=>{let t=4;localStorage.getItem("method")&&(t=localStorage.getItem("method"));const o=`https://api.aladhan.com/v1/timings/${e}?latitude=${localStorage.getItem("Latitude")}&longitude=${localStorage.getItem("Longitude")}&method=${t}&tune=${tune}`;if(localStorage.getItem("Latitude")&&localStorage.getItem("Longitude"))try{const e=await fetch(o),t=await e.json();if(e.ok){const e={date:`${t.data.date.hijri.day} ${t.data.date.hijri.month.en} ${t.data.date.hijri.year}`,Fajr:t.data.timings.Fajr,Sunrise:t.data.timings.Sunrise,Dhuhr:t.data.timings.Dhuhr,Asr:t.data.timings.Asr,Maghrib:t.data.timings.Maghrib,Isha:t.data.timings.Isha};localStorage.setItem("Prayer",JSON.stringify(e)),console.log("API Data Received!")}}catch(e){console.error(e),console.error("Fetch error!"),errorMessage("red","Could not fetch prayer times. :(")}},newDay=e=>{e!==(new Date).toLocaleDateString()&&(reload(),playAudio=!1,console.log("New Day Loaded"))};localStorage.getItem("Latitude")||localStorage.getItem("Longitude")||(toggleSettings(),navigator.geolocation.getCurrentPosition(success,error),errorMessage("red","Set your location or refresh to load device location."));const initApp=()=>{const e=new Date;let t=`${e.getDate()}-${e.getMonth()+1}-${e.getFullYear()}`;return getTime(t).then((()=>{const t=JSON.parse(localStorage.getItem("Prayer"));if(t){for(let e=0;e<=5;e++)document.querySelector(`#${timing[e]}`).innerHTML=to12Hour(t[timing[e]]),document.querySelector(`#${timing[e]}`).setAttribute("datetime",t[timing[e]]);document.querySelector("#hijri").innerHTML=t.date,document.querySelector("#hijri").setAttribute("datetime",e.toISOString().slice(0,10))}})),e};let today=initApp(),x=0,playAudio=!1,fajr=!1;document.getElementById("tuneButton").addEventListener("click",(e=>{e.preventDefault();for(let e=0;e<6;e++){const t=getTune(`tune${timing[e]}`);void 0!==t&&(localStorage.setItem(`tune${timing[e]}`,t),timingOffset[e]=t)}setTune(),reload(),errorMessage("green","Tune set successfully!"),document.querySelector(".tuneForm").classList.toggle("tune-open"),changeTuneText(),document.querySelector(".setting-blur").classList.toggle("darken-bg"),setTimeout((()=>toggleSettings()),250)}));const refreshFunction=()=>{if(localStorage.getItem("Prayer")){const e=JSON.parse(localStorage.getItem("Prayer")),t=new Date,o=toSeconds(to24Hour(t.toLocaleTimeString()))-toSeconds(e[timing[x]]),n=toHours(o);document.querySelector("#remaining").innerHTML=timing[x],0!==x||fajr||(document.querySelector("#audio-alert").setAttribute("src","azan-fajr.mp3"),document.querySelector("#azanLink").setAttribute("href","https://www.youtube.com/watch?v=7GPPH34Ep74"),fajr=!0),0!==o||playAudio||1===x||(document.querySelector("#audio-alert").play(),playAudio=!0),1===o&&playAudio&&(playAudio=!1,console.log(`playAudio = ${playAudio}`)),o>1800&&5!==x&&(x++,fajr=!1,document.querySelector("#audio-alert").setAttribute("src","azan.mp3"),document.querySelector("#azanLink").setAttribute("href","https://www.youtube.com/watch?v=FliFWDRzaxM")),document.getElementById("count").textContent=o<0?"- "+n:"+ "+n,today.toLocaleDateString()!==(new Date).toLocaleDateString()&&(reload(),playAudio=!1,console.log("New Day Loaded"))}},refreshInterval=setInterval((()=>refreshFunction()),20);let lightMode;setTimeout((()=>{clearInterval(refreshInterval),setInterval((()=>refreshFunction()),1e3)}),200),document.querySelector("#settings-btn").addEventListener("click",(()=>{toggleSettings(),localStorage.getItem("Location")?document.getElementById("currentLocation").innerHTML=localStorage.getItem("Location"):localStorage.getItem("Latitude")&&localStorage.getItem("Longitude")&&!localStorage.getItem("Location")&&reverseLocation()})),lightMode=!localStorage.getItem("lightMode")||JSON.parse(localStorage.getItem("lightMode")),lightMode&&(document.getElementById("theme").setAttribute("href","css/light.css"),document.querySelector("#theme-btn img").setAttribute("src","images/theme-icon-dark.svg")),document.querySelector("#theme-btn").addEventListener("click",(()=>{const e=document.getElementById("theme"),t=document.querySelector("#theme-btn img");lightMode?(e.removeAttribute("href"),t.setAttribute("src","images/theme-icon.svg"),localStorage.setItem("lightMode",!1),lightMode=!1):(e.setAttribute("href","css/light.css"),t.setAttribute("src","images/theme-icon-dark.svg"),localStorage.setItem("lightMode",!0),lightMode=!0)}));const suggestionsDiv=document.getElementById("suggestions");document.getElementById("address").addEventListener("input",(function(){const e=this.value;if(e.length<3)return void(suggestionsDiv.innerHTML="");const t=`https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(e)}&format=json&limit=5`;fetch(t).then((e=>e.json())).then((e=>{suggestionsDiv.innerHTML="",e.forEach((e=>{const t=document.createElement("div");t.textContent=e.display_name,t.addEventListener("click",(()=>{document.getElementById("address").value=e.display_name,suggestionsDiv.innerHTML=""})),suggestionsDiv.appendChild(t)}))})).catch((e=>{console.error("Error fetching suggestions:",e),errorMessage("red","Could not fetch location!")}))})),document.getElementById("geocodeForm").addEventListener("submit",(function(e){e.preventDefault();const t=document.getElementById("address").value;if(0===t.length)return;const o=`https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(t)}&format=json`;fetch(o).then((e=>e.json())).then((e=>{if(e.length>0){const t=e[0];localStorage.setItem("Latitude",t.lat),localStorage.setItem("Longitude",t.lon),localStorage.setItem("Location",t.display_name),errorMessage("green","Location set successfully!"),document.getElementById("currentLocation").innerHTML=localStorage.getItem("Location"),reload(),setTimeout((()=>toggleSettings()),250)}else errorMessage("red","Location not found!")})).catch((e=>{console.error("Error fetching suggestions:",e),errorMessage("red","Could not set location!")}))}));const zoom=()=>{const e=document.querySelector("#zoom").value;isNaN(parseFloat(e))||(localStorage.setItem("scale",e),document.querySelector(":root").style.setProperty("--scale",e),console.log("scale set!"),toggleSettings())},method=()=>{const e=document.querySelector("#method").value;!isNaN(parseInt(e))&&parseInt(e)>=0&&parseInt(e)<24&&(localStorage.setItem("method",e),errorMessage("green","Calculation method set successfully!"),reload(),setTimeout((()=>toggleSettings()),250))};document.querySelector("#setZoom").onclick=e=>{e.preventDefault(),zoom()},document.querySelector("#setMethod").onclick=e=>{e.preventDefault(),method()},localStorage.getItem("scale")&&document.querySelector(":root").style.setProperty("--scale",localStorage.getItem("scale")),document.querySelector(".tune").onclick=e=>{e.preventDefault(),document.querySelector(".tuneForm").classList.toggle("tune-open"),document.querySelector(".setting-blur").classList.toggle("darken-bg"),changeTuneText()},document.querySelector("#location-btn").onclick=e=>{e.preventDefault(),navigator.geolocation.getCurrentPosition(success,error),errorMessage("green","Location set successfully!"),reverseLocation(),reload(),setTimeout((()=>toggleSettings()),500)};