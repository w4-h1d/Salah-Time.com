const toHours=e=>{0>parseInt(e)&&(e=-1*parseInt(e));let t=((e=parseInt(e))-e%3600)/3600,r=e-3600*t,n=(r-r%60)/60;return r-=60*n,t<10&&(t="0"+t),n<10&&(n="0"+n),r<10&&(r="0"+r),`${t}:${n}:${r}`},toSeconds=e=>{let t=/(\d{2}:\d{2}):*\d*\d*/g;if(!t.test(e))throw Error("Invalid Time Format. Please use {HH:MM} or {HH:MM:SS} format.");let r=parseInt(e.slice(0,2)),n=parseInt(e.slice(3,5)),i=parseInt(e.slice(6,8));return isNaN(i)&&(i=0),3600*r+60*n+i},to12Hour=e=>{let t=/([0-9]{2}:[0-9]{2})/g;if(!t.test(e))throw Error("Invalid Time Format. Please use {HH:MM} format.");let r=parseInt(e.slice(0,2));if(r>23||r<0)throw Error("Time out of range.");return r>12?((r-=12)<10&&(r="0"+r),`${r}${e.slice(2,5)} PM`):12===r?`${r}${e.slice(2,5)} PM`:0===r?`${r=12}${e.slice(2,5)} AM`:`${e} AM`},to24Hour=e=>(10>parseInt(e.slice(0,1))&&":"===e.slice(1,2)&&(e="0"+e),"AM"===e.slice(9,11)&&"12"===e.slice(0,2))?`00${e.slice(2,8)}`:"AM"===e.slice(9,11)?e.slice(0,8):"PM"===e.slice(9,11)&&"12"===e.slice(0,2)?e.slice(0,8):"PM"===e.slice(9,11)?`${parseInt(e.slice(0,2))+12}${e.slice(2,8)}`:void 0,success=e=>{let t=e.coords;localStorage.setItem("Latitude",t.latitude),localStorage.setItem("Longitude",t.longitude)},error=e=>{console.warn(`ERROR(${e.code}): ${e.message}`)},timing=["Fajr","Sunrise","Dhuhr","Asr","Maghrib","Isha"];let Fajr=0,Sunrise=0,Dhuhr=0,Asr=0,Maghrib=0,Isha=0,Imsak=0,Sunset=0,Midnight=0,tune;const timingOffset=[Fajr,Sunrise,Dhuhr,Asr,Maghrib,Isha],getTune=e=>{let t=document.getElementById(e).value;if(0!==t.length&&!isNaN(parseInt(t)))return parseInt(t)},setTune=()=>{for(let e=0;e<6;e++)localStorage.getItem(`tune${timing[e]}`)&&(timingOffset[e]=localStorage.getItem(`tune${timing[e]}`));tune=`${Imsak},${timingOffset[0]},${timingOffset[1]},${timingOffset[2]},${timingOffset[3]},${timingOffset[4]},${Sunset},${timingOffset[5]},${Midnight}`},reload=()=>{today=initApp(),x=0},toggleSettings=()=>{document.querySelector(".setting").classList.toggle("settings-open"),document.querySelector("#widget").classList.toggle("darken-bg")},errorMessage=(e,t)=>{document.querySelector("#audioCredit").style.display="none",document.querySelector("#errorMessage").style.color=`var(--error-${e})`,document.querySelector("#errorMessage").innerText=t},changeTuneText=()=>{let e=document.querySelector(".tune");"Set Timing Offsets"===e.innerText?e.innerHTML='<img src="images/tune-icon.svg" alt="tune icon" width="16" height="16">Close Timing Offsets':e.innerHTML='<img src="images/tune-icon.svg" alt="tune icon" width="16" height="16">Set Timing Offsets'},reverseLocation=()=>{let e=`https://nominatim.openstreetmap.org/reverse?lat=${localStorage.getItem("Latitude")}&lon=${localStorage.getItem("Longitude")}&format=json`;fetch(e).then(e=>e.json()).then(e=>{e.error?document.getElementById("currentLocation").innerHTML="Device Location":(localStorage.setItem("Location",e.display_name),document.getElementById("currentLocation").innerHTML=e.display_name)}).catch(e=>{console.error("Error fetching suggestions:",e),document.getElementById("currentLocation").innerHTML="Cannot detect location!",document.getElementById("currentLocation").style.color="var(--error-red)"}),document.getElementById("currentLocation").innerHTML="Device Location"};setTune();const getTime=async e=>{let t=4;localStorage.getItem("method")&&(t=localStorage.getItem("method"));let r=`https://api.aladhan.com/v1/timings/${e}?latitude=${localStorage.getItem("Latitude")}&longitude=${localStorage.getItem("Longitude")}&method=${t}&tune=${tune}`;if(localStorage.getItem("Latitude")&&localStorage.getItem("Longitude"))try{let n=await fetch(r),i=await n.json();if(n.ok){let o={date:`${i.data.date.hijri.day} ${i.data.date.hijri.month.en} ${i.data.date.hijri.year}`,Fajr:i.data.timings.Fajr,Sunrise:i.data.timings.Sunrise,Dhuhr:i.data.timings.Dhuhr,Asr:i.data.timings.Asr,Maghrib:i.data.timings.Maghrib,Isha:i.data.timings.Isha};localStorage.setItem("Prayer",JSON.stringify(o)),console.log("API Data Received!")}}catch(s){console.error(s),console.error("Fetch error!"),errorMessage("red","Could not fetch prayer times. :(")}},newDay=e=>{let t=new Date;e!==t.toLocaleDateString()&&(reload(),playAudio=!1,console.log("New Day Loaded"))};localStorage.getItem("Latitude")||localStorage.getItem("Longitude")||(toggleSettings(),errorMessage("red","Set your location."));const initApp=()=>{let e=new Date;return getTime(`${e.getDate()}-${e.getMonth()+1}-${e.getFullYear()}`).then(()=>{let t=JSON.parse(localStorage.getItem("Prayer"));if(t){for(let r=0;r<=5;r++)document.querySelector(`#${timing[r]}`).innerHTML=to12Hour(t[timing[r]]),document.querySelector(`#${timing[r]}`).setAttribute("datetime",t[timing[r]]);document.querySelector("#hijri").innerHTML=t.date,document.querySelector("#hijri").setAttribute("datetime",e.toISOString().slice(0,10))}}),e};let today=initApp(),x=0,playAudio=!1,fajr=!1;document.getElementById("tuneButton").addEventListener("click",e=>{e.preventDefault();for(let t=0;t<6;t++){let r=getTune(`tune${timing[t]}`);void 0!==r&&(localStorage.setItem(`tune${timing[t]}`,r),timingOffset[t]=r)}setTune(),reload(),errorMessage("green","Tune set successfully!"),document.querySelector(".tuneForm").classList.toggle("tune-open"),changeTuneText(),document.querySelector(".setting-blur").classList.toggle("darken-bg"),setTimeout(()=>toggleSettings(),250)});const refreshFunction=()=>{if(localStorage.getItem("Prayer")){let e=JSON.parse(localStorage.getItem("Prayer")),t=new Date,r=toSeconds(to24Hour(t.toLocaleTimeString())),n=toSeconds(e[timing[x]]),i=r-n,o=toHours(i);document.querySelector("#remaining").innerHTML=timing[x],0!==x||fajr||(document.querySelector("#audio-alert").setAttribute("src","azan-fajr.mp3"),document.querySelector("#azanLink").setAttribute("href","https://www.youtube.com/watch?v=7GPPH34Ep74"),fajr=!0),0!==i||playAudio||1===x||(document.querySelector("#audio-alert").play(),playAudio=!0),1===i&&playAudio&&(playAudio=!1,console.log(`playAudio = ${playAudio}`)),i>1800&&5!==x&&(x++,fajr=!1,document.querySelector("#audio-alert").setAttribute("src","azan.mp3"),document.querySelector("#azanLink").setAttribute("href","https://www.youtube.com/watch?v=FliFWDRzaxM")),i<0?document.getElementById("count").textContent="- "+o:document.getElementById("count").textContent="+ "+o,newDay(today.toLocaleDateString())}},refreshInterval=setInterval(()=>refreshFunction(),20);setTimeout(()=>{clearInterval(refreshInterval),setInterval(()=>refreshFunction(),1e3)},200),document.querySelector("#settings-btn").addEventListener("click",()=>{toggleSettings(),localStorage.getItem("Location")?document.getElementById("currentLocation").innerHTML=localStorage.getItem("Location"):localStorage.getItem("Latitude")&&localStorage.getItem("Longitude")&&!localStorage.getItem("Location")&&reverseLocation()});let lightMode;(lightMode=!localStorage.getItem("lightMode")||JSON.parse(localStorage.getItem("lightMode")))&&(document.getElementById("theme").setAttribute("href","css/light.css"),document.querySelector("#theme-btn img").setAttribute("src","images/theme-icon-dark.svg")),document.querySelector("#theme-btn").addEventListener("click",()=>{let e=document.getElementById("theme"),t=document.querySelector("#theme-btn img");lightMode?(e.removeAttribute("href"),t.setAttribute("src","images/theme-icon.svg"),localStorage.setItem("lightMode",!1),lightMode=!1):(e.setAttribute("href","css/light.css"),t.setAttribute("src","images/theme-icon-dark.svg"),localStorage.setItem("lightMode",!0),lightMode=!0)});const suggestionsDiv=document.getElementById("suggestions");document.getElementById("address").addEventListener("input",function(){let e=this.value;if(e.length<3){suggestionsDiv.innerHTML="";return}let t=`https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(e)}&format=json&limit=5`;fetch(t).then(e=>e.json()).then(e=>{suggestionsDiv.innerHTML="",e.forEach(e=>{let t=document.createElement("div");t.textContent=e.display_name,t.addEventListener("click",()=>{document.getElementById("address").value=e.display_name,suggestionsDiv.innerHTML=""}),suggestionsDiv.appendChild(t)})}).catch(e=>{console.error("Error fetching suggestions:",e),errorMessage("red","Could not fetch location!")})}),document.getElementById("geocodeForm").addEventListener("submit",function(e){e.preventDefault();let t=document.getElementById("address").value;if(0===t.length)return;let r=`https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(t)}&format=json`;fetch(r).then(e=>e.json()).then(e=>{if(e.length>0){let t=e[0];localStorage.setItem("Latitude",t.lat),localStorage.setItem("Longitude",t.lon),localStorage.setItem("Location",t.display_name),errorMessage("green","Location set successfully!"),document.getElementById("currentLocation").innerHTML=localStorage.getItem("Location"),reload(),setTimeout(()=>toggleSettings(),250)}else errorMessage("red","Location not found!")}).catch(e=>{console.error("Error fetching suggestions:",e),errorMessage("red","Could not set location!")})});const zoom=()=>{let e=document.querySelector("#zoom").value;isNaN(parseFloat(e))||(localStorage.setItem("scale",e),document.querySelector(":root").style.setProperty("--scale",e),console.log("scale set!"),toggleSettings())},method=()=>{let e=document.querySelector("#method").value;!isNaN(parseInt(e))&&parseInt(e)>=0&&24>parseInt(e)&&(localStorage.setItem("method",e),errorMessage("green","Calculation method set successfully!"),reload(),setTimeout(()=>toggleSettings(),250))};document.querySelector("#setZoom").onclick=e=>{e.preventDefault(),zoom()},document.querySelector("#setMethod").onclick=e=>{e.preventDefault(),method()},localStorage.getItem("scale")&&document.querySelector(":root").style.setProperty("--scale",localStorage.getItem("scale")),document.querySelector(".tune").onclick=e=>{e.preventDefault(),document.querySelector(".tuneForm").classList.toggle("tune-open"),document.querySelector(".setting-blur").classList.toggle("darken-bg"),changeTuneText()},document.querySelector("#location-btn").onclick=e=>{e.preventDefault(),navigator.geolocation.getCurrentPosition(success,error),errorMessage("green","Location set successfully!"),reverseLocation(),reload(),setTimeout(()=>toggleSettings(),500)};